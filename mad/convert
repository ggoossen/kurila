#!/usr/bin/perl

use strict;
use warnings;

use lib "$ENV{madpath}/mad";

use Convert;

use Fatal qw|open close|;

{
    local $/ = undef;
    my $filename = $ARGV[0];
    my $fh;
    open $fh, '+<', "$filename";
    my $input = $fh->getline;
    my $output = eval { Convert::convert($input, "/usr/bin/perl $ENV{madpath}/mad/p5kurila.pl") };
    if ($output) {
        seek $fh, 0, 0;
        $fh->print($output);
    } else {
        warn "Failed converting $filename:\n\n$@\n\n";
    }
}

